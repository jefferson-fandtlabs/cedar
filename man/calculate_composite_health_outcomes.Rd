% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calculate_composite_health_outcomes.R
\name{calculate_composite_health_outcomes}
\alias{calculate_composite_health_outcomes}
\title{Calculate Composite Health Outcomes}
\usage{
calculate_composite_health_outcomes(
  outcome_components,
  base_outcomes,
  edge_properties = NULL
)
}
\arguments{
\item{outcome_components}{A health_outcome_components object created by
\code{\link{specify_health_outcome_components}}. Defines how to calculate
each composite health outcome from base outcome values.}

\item{base_outcomes}{A named list of base health outcome values. Names must
match the base_outcome_name values in outcome_components. Values are numeric
and represent:
\itemize{
  \item For "utility_to_qaly": Health utility values (typically 0-1)
  \item For "life_years": Life year multipliers (typically 1, but can be
    adjusted for quality or other factors)
  \item For "qaly_direct": Pre-calculated QALY values
}}

\item{edge_properties}{Optional data frame or tibble containing edge-specific
properties including duration values. Must contain columns: from_node, to_node,
plus columns matching the duration_unit values used in outcome_components
(e.g., "days", "months", "years"). Only needed if outcome_components has
NA values in duration_value column.}
}
\value{
A named list where each name is an outcome_label and each value is
  the calculated composite health outcome value. For QALY calculations, values
  are in QALYs. For life years, values are in years.
}
\description{
Calculates composite health outcomes by combining base outcome values with
durations from edge properties. Supports different outcome types including
utility-to-QALY conversion, life years, and direct QALY values.
}
\details{
The calculation process:
\enumerate{
  \item For each outcome_label in outcome_components:
  \itemize{
    \item Retrieve all components associated with that outcome_label
    \item For each component:
    \itemize{
      \item Get base outcome value from base_outcomes
      \item Determine duration value (from component's duration_value or
        edge_properties lookup)
      \item Convert duration to years using \code{\link{convert_duration_to_years}}
      \item Calculate component outcome based on outcome_type:
      \itemize{
        \item \strong{utility_to_qaly}: base_outcome * years_duration = QALYs
        \item \strong{life_years}: base_outcome * years_duration = life years
        \item \strong{qaly_direct}: base_outcome (duration not used)
      }
      \item Sum all components for the outcome_label
    }
  }
  \item Return named list of outcome_label -> total_outcome
}

\strong{Outcome Type Details:}

\emph{utility_to_qaly:}
Converts health utility values to QALYs by multiplying utility by duration
in years. For example:
\itemize{
  \item Utility = 0.8 (health state utility)
  \item Duration = 2 years
  \item QALY = 0.8 * 2 = 1.6 QALYs
}

\emph{life_years:}
Calculates life years by multiplying a base value (typically 1) by duration
in years. The base value can be adjusted for quality factors. For example:
\itemize{
  \item Base = 1.0 (full life years)
  \item Duration = 5 years
  \item Life years = 1.0 * 5 = 5 years
}

\emph{qaly_direct:}
Uses pre-calculated QALY values directly without duration multiplication.
Useful when QALYs have been calculated externally or come from literature.

\strong{Duration Handling:}

Durations can be specified in two ways:
\enumerate{
  \item \strong{Explicit}: Set duration_value in outcome_components
  \item \strong{Edge lookup}: Leave duration_value as NA and provide
    edge_properties with columns matching duration_unit names
}

All durations are converted to years using 365.25 days per year to account
for leap years, which is the standard in epidemiology and health economics.
}
\examples{
library(tibble)

# Example 1: Utility to QALY conversion
# Define base utilities
base_outcomes <- list(
  utility_success = 0.85,
  utility_failure = 0.65
)

# Specify outcome components with explicit durations
outcome_components <- tribble(
  ~outcome_label, ~base_outcome_name, ~outcome_type, ~duration_unit, ~edge_from, ~edge_to, ~duration_value,
  "qaly_success", "utility_success", "utility_to_qaly", "years", 2, 4, 5,
  "qaly_failure", "utility_failure", "utility_to_qaly", "months", 2, 5, 6
) |>
  specify_health_outcome_components()

# Calculate composite outcomes
composite_outcomes <- calculate_composite_health_outcomes(
  outcome_components,
  base_outcomes
)

# Results:
# qaly_success = 0.85 * 5 = 4.25 QALYs
# qaly_failure = 0.65 * 0.5 = 0.325 QALYs (6 months = 0.5 years)

# Example 2: Using edge properties for duration lookup
edge_props <- tribble(
  ~from_node, ~to_node, ~years, ~months,
  2, 4, 5, NA,
  2, 5, NA, 6
)

outcome_components_lookup <- tribble(
  ~outcome_label, ~base_outcome_name, ~outcome_type, ~duration_unit, ~edge_from, ~edge_to,
  "qaly_success", "utility_success", "utility_to_qaly", "years", 2, 4,
  "qaly_failure", "utility_failure", "utility_to_qaly", "months", 2, 5
) |>
  specify_health_outcome_components()

composite_outcomes_lookup <- calculate_composite_health_outcomes(
  outcome_components_lookup,
  base_outcomes,
  edge_props
)

# Example 3: Mixed outcome types
mixed_base_outcomes <- list(
  utility_treatment = 0.80,
  ly_multiplier = 1.0,
  precalc_qaly = 2.5
)

mixed_components <- tribble(
  ~outcome_label, ~base_outcome_name, ~outcome_type, ~duration_unit, ~edge_from, ~edge_to, ~duration_value,
  "total_qaly", "utility_treatment", "utility_to_qaly", "years", 1, 2, 3,
  "total_qaly", "precalc_qaly", "qaly_direct", "years", 2, 3, NA,
  "life_years", "ly_multiplier", "life_years", "years", 1, 2, 10
) |>
  specify_health_outcome_components()

mixed_outcomes <- calculate_composite_health_outcomes(
  mixed_components,
  mixed_base_outcomes
)

# Results:
# total_qaly = (0.80 * 3) + 2.5 = 4.9 QALYs
# life_years = 1.0 * 10 = 10 years

}
\seealso{
\code{\link{specify_health_outcome_components}} for creating valid component specifications,
\code{\link{convert_duration_to_years}} for duration conversion details,
\code{\link{build_decision_tree_table}} for integration with decision trees
}
