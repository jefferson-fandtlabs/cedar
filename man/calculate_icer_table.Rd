% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calculate_icer_table.R
\name{calculate_icer_table}
\alias{calculate_icer_table}
\title{Calculate Incremental Cost-Effectiveness Ratio (ICER) Table}
\usage{
calculate_icer_table(
  decision_tree_table,
  base_scenario = 2,
  incremental_mode = c("base", "previous"),
  scenario_labels = NULL,
  base_label_symbol = "*",
  sort_by_node = TRUE
)
}
\arguments{
\item{decision_tree_table}{Data frame output from \code{\link{build_decision_tree_table}}.
Must contain columns: from_node, to_node, probability, cost, health_outcome.}

\item{base_scenario}{Integer specifying which scenario node to use as the base
comparator for incremental calculations. Must be a direct child of node 1.
Default is 2.}

\item{incremental_mode}{Character string specifying how to calculate incremental
values. Options are:
\itemize{
  \item "base" (default): All scenarios compared to base_scenario
  \item "previous": Each scenario compared to the previous row (after sorting)
}}

\item{scenario_labels}{Optional named list providing custom labels for scenarios.
Names should be node numbers as strings, values are display labels.
Example: \code{list("2" = "Standard Care", "3" = "New Treatment")}.
If NULL (default), labels will be "Scenario X" where X is the node number.}

\item{base_label_symbol}{Character string to append to the base scenario label
to mark it in the output. Default is "*".}

\item{sort_by_node}{Logical indicating whether to sort results by scenario node
number. Default is TRUE.}
}
\value{
A data frame with one row per scenario containing:
  \itemize{
    \item scenario_node: Integer node number representing the scenario
    \item scenario_label: Character display name (with base marker if applicable)
    \item total_cost: Numeric probability-weighted expected cost
    \item total_health_outcome: Numeric probability-weighted expected health outcome
    \item incremental_cost: Numeric cost difference from comparator
    \item incremental_health_outcome: Numeric health outcome difference from comparator
    \item icer: Character or numeric ICER value, or special label
    \item icer_interpretation: Character description of ICER result
  }
}
\description{
Performs incremental cost-effectiveness analysis on decision tree results.
Takes the output from \code{\link{build_decision_tree_table}} and calculates
total costs, total health outcomes, incremental values, and ICERs for each
scenario (initial choice node from node 1). Uses probability weighting along
paths to terminal nodes to calculate expected values.
}
\details{
The function performs the following steps:
\enumerate{
  \item Identifies all scenarios (direct children of node 1)
  \item For each scenario, traces all paths to terminal nodes
  \item Calculates probability-weighted expected costs and health outcomes
  \item Computes incremental values based on selected mode
  \item Calculates and interprets ICER values
}

ICER interpretation follows standard health economics conventions:
\itemize{
  \item "Ref": Reference/base scenario (incremental values = 0)
  \item "Dominant": Less costly and more effective (should be preferred)
  \item "Dominated": More costly and less effective (should be rejected)
  \item "Inf": Same effectiveness but higher cost (no benefit for extra cost)
  \item "-Inf": Same effectiveness but lower cost (cost saving, no effect change)
  \item Numeric: Standard ICER = incremental_cost / incremental_health_outcome
}

Probability weighting: Each terminal node's cost and health outcome are
multiplied by the product of all probabilities along the path from the
scenario node to that terminal node. These weighted values are summed
across all terminal nodes reachable from each scenario.
}
\examples{
\dontrun{
# Define tree structure
tree <- list(
  "1" = c(2, 3),
  "2" = c(4, 5),
  "3" = c(6, 7)
)

# Define values
costs <- list("c1" = 1000, "c2" = 1500, "c3" = 2000, "c4" = 2500)
probs <- list("p1" = 0.6, "p2" = 0.4, "p3" = 0.7, "p4" = 0.3)
outcomes <- list("qaly1" = 0.8, "qaly2" = 0.6, "qaly3" = 0.9, "qaly4" = 0.7)

# Define associations
cost_assoc <- tibble::tibble(
  name = c("c1", "c2", "c3", "c4"),
  from_node = c(2, 2, 3, 3),
  to_node = c(4, 5, 6, 7)
)

prob_assoc <- tibble::tibble(
  name = c("p1", "p2", "p3", "p4"),
  from_node = c(2, 2, 3, 3),
  to_node = c(4, 5, 6, 7)
)

outcome_assoc <- tibble::tibble(
  name = c("qaly1", "qaly2", "qaly3", "qaly4"),
  from_node = c(2, 2, 3, 3),
  to_node = c(4, 5, 6, 7)
)

# Build decision tree table
tree_table <- build_decision_tree_table(
  tree, costs, probs, outcomes,
  cost_assoc, prob_assoc, outcome_assoc
)

# Calculate ICER table with default settings (base mode, scenario 2 as base)
icer_results <- calculate_icer_table(tree_table)

# Calculate ICER with custom labels
labels <- list("2" = "Standard Care", "3" = "New Treatment")
icer_results <- calculate_icer_table(
  tree_table,
  scenario_labels = labels
)

# Calculate ICER using previous row comparison
icer_results <- calculate_icer_table(
  tree_table,
  incremental_mode = "previous"
)
}

}
